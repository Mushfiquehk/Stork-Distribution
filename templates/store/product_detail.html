{% extends './../base.html' %}
{% load static %}
{% block content %}

<section class="bg-gray-100 px-8 py-8">
  <div class="flex justify-center">
    <div class="flex text-base text-left w-full md:inline-block md:max-w-2xl md:px-4 md:my-8 md:align-middle lg:max-w-4xl">
      <div class="w-full rounded-lg relative flex items-center bg-white px-4 pt-14 pb-8 overflow-hidden shadow-2xl sm:px-6 sm:pt-8 md:p-6 lg:p-8">
        <a href="javascript:history.go(-1)" class="no-underline absolute top-4 right-4 text-gray-400 hover:text-gray-500 sm:top-8 sm:right-6 md:top-6 md:right-6 lg:top-8 lg:right-8">
          <span class="sr-only">Close</span>
          <!-- Heroicon name: outline/x -->
          <span class="text-3xl" aria-hidden="true">&times;</span>
        </a>

        <div class="w-full grid grid-cols-1 gap-y-8 gap-x-6 items-start sm:grid-cols-12 lg:gap-x-8">
          <div class="flex justify-center self-center rounded-lg bg-white overflow-hidden sm:col-span-4 lg:col-span-5">
            <img src="{{ product.image.url }}" alt="{{ product.description }}" class="object-center object-cover">
          </div>
          <div class="sm:col-span-8 lg:col-span-7">
            <h2 class="text-2xl font-bold text-gray-900 sm:pr-12">{{ product.name }}</h2>

            <section aria-labelledby="information-heading" class="my-2">
              <h3 id="information-heading" class="sr-only">Product information</h3>

              <!-- SKU -->
              <div class="">
                <h4 class="sr-only">Stock Keeping Unit</h4>
                <div class="text-xs font-light tracking-wider text-gray-500">SKU# {{ product.id }}</div>
              </div>

              {% if request.user.is_authenticated %}
                <p class="text-xl tracking-wide font-bold text-gray-900 mt-2">&dollar;{{ product.price }}</p>
              {% else %}
                <a class="text-lg font-medium tracking-wide text-cyan-600 mt-2" href="{% url "store:login" %}">Login to see price</a>
              {% endif %}

            </section>

            <section aria-labelledby="options-heading" class="mt-4">
              <h3 id="options-heading" class="sr-only">Product options</h3>
              <form>
                <div class="grid grid-cols-4 gap-4 content-center rounded-lg bg-white overflow-hidden">
                  {% for option in options %}
                  <a href="{{ option.get_absolute_url }}" class="shadow-md">
                    <img src="{{ option.image.url }}" alt="options" class="object-center object-cover">
                  </a>
                  {% endfor %}
                </div>
              </form>
            </section>

            <section aria-labelledby="amounts-heading" class="mt-6">
              <h3 id="amounts-heading" class="sr-only">Product amounts</h3>

              <form>
                <!-- Amount -->
                <div class="mt-8">
                  <div class="flex items-center justify-start">
                    <h4 class="text-md text-gray-900 font-medium">Amount: </h4>
                  </div>
                  
                  <!-- out of stock label -->
                  {% if amount < 5 %}
                    <p class="text-orange-500 text-sm italic">Low stock. Order early to get the last ones!</p>
                  {% endif %}
                  <fieldset class="mt-2">
                    <legend class="sr-only">Choose an amount</legend>

                    <label class="group relative mb-4 flex items-center justify-center text-sm font-medium shadow-sm uppercase">
                      <input type="number" name="amount" min="0" max="{{ amount }}" id="amount" value="1" class="border border-gray-200 rounded-md w-full focus:bg-gray-100 focus:outline-none sm:flex-1 bg-white text-gray-900 cursor-pointer" aria-labelledby="amount-select">
                    </label>

                    <div class="grid grid-cols-4 gap-2">                      
                      <button type="button" class="group amt-val border rounded-md py-3 px-4 flex items-center justify-center text-sm font-medium uppercase hover:bg-gray-50 focus:outline-none sm:flex-1 bg-white shadow-sm text-gray-900 cursor-pointer" {% if amount < 5 %}style="text-decoration:line-through 2px;"disabled{% endif %}>5</button>
                      <button type="button" class="group amt-val border rounded-md py-3 px-4 flex items-center justify-center text-sm font-medium uppercase hover:bg-gray-50 focus:outline-none sm:flex-1 bg-white shadow-sm text-gray-900 cursor-pointer" {% if amount < 10 %}style="text-decoration:line-through 2px;"disabled{% endif %}>10</button>  
                      <button type="button" class="group amt-val border rounded-md py-3 px-4 flex items-center justify-center text-sm font-medium uppercase hover:bg-gray-50 focus:outline-none sm:flex-1 bg-white shadow-sm text-gray-900 cursor-pointer" {% if amount < 25 %}style="text-decoration:line-through 2px;"disabled{% endif %}>25</button>                   
                      <button type="button" class="group amt-val border rounded-md py-3 px-4 flex items-center justify-center text-sm font-medium uppercase hover:bg-gray-50 focus:outline-none sm:flex-1 bg-white shadow-sm text-gray-900 cursor-pointer" {% if amount < 50 %}style="text-decoration:line-through 2px;"disabled{% endif %}>50</button>               
                      <button type="button" class="group amt-val border rounded-md py-3 px-4 flex items-center justify-center text-sm font-medium uppercase hover:bg-gray-50 focus:outline-none sm:flex-1 bg-white shadow-sm text-gray-900 cursor-pointer" {% if amount < 75 %}style="text-decoration:line-through 2px;"disabled{% endif %}>75</button>
                      <button type="button" class="group amt-val border rounded-md py-3 px-4 flex items-center justify-center text-sm font-medium uppercase hover:bg-gray-50 focus:outline-none sm:flex-1 bg-white shadow-sm text-gray-900 cursor-pointer" {% if amount < 100 %}style="text-decoration:line-through 2px;"disabled{% endif %}>100</button>
                      <button type="button" class="group amt-val border rounded-md py-3 px-4 flex items-center justify-center text-sm font-medium uppercase hover:bg-gray-50 focus:outline-none sm:flex-1 bg-white shadow-sm text-gray-900 cursor-pointer" {% if amount < 250 %}style="text-decoration:line-through 2px;"disabled{% endif %}>250</button>
                      <button type="button" class="group amt-val border rounded-md py-3 px-4 flex items-center justify-center text-sm font-medium uppercase hover:bg-gray-50 focus:outline-none sm:flex-1 bg-white shadow-sm text-gray-900 cursor-pointer" {% if amount < 500 %}style="text-decoration:line-through 2px;"disabled{% endif %}>500</button>
                    </div>
                  </fieldset>
                </div>

                <button id="update-cart" value="{{ product.id }}" class="mt-6 w-full bg-cyan-600 rounded-md py-3 px-8 flex items-center justify-center text-base font-medium text-white hover:bg-cyan-500 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-cyan-500">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5 mx-1" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3zM16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z" />
                  </svg>
                  Add to bag
                </button>
              </form>
            </section>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

{% endblock %}

{% block scripts %}
<script src="{% static "store/js/product_detail.js" %}"></script>
<script>
  // script to update cart with product 
  
  const addToCart = document.querySelector('#update-cart')

  addToCart.addEventListener('click', function (event) {
    event.preventDefault();
    if ($('#amount').val() > 0) {        
    $.ajax({
      type: 'POST',
      url: "{% url 'store:update_cart' %}",
      data: {
        product_id: $('#update-cart').val(),
        amount: $('#amount').val(), // fix this
        csrfmiddlewaretoken: "{{ csrf_token }}",
        action: 'update',
      },
      success: function (json) {
        $("#cart-items").innerHTML = json.items
      },
      error: function (xhr, errmsg, err) {}
    });
    };
  });
</script>
{% endblock %}